<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline C++ Code Fixer Game</title>
    <style>
        /* CSS will be embedded for offline use */
        body {
            font-family: 'Courier New', monospace;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .score {
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .score span {
            margin-left: 15px;
        }
        
        .game-area {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .code-container, .editor-container {
            flex: 1;
            min-width: 300px;
        }
        
        pre {
            background-color: #282c34;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            height: 300px;
            overflow-y: auto;
            color: #abb2bf;
        }
        
        code {
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        textarea {
            width: 100%;
            height: 300px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: none;
            margin-bottom: 10px;
            background-color: #282c34;
            color: #abb2bf;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin-right: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        #hint-btn {
            background-color: #2196F3;
        }
        
        #hint-btn:hover {
            background-color: #0b7dda;
        }
        
        #next-btn {
            background-color: #ff9800;
        }
        
        #next-btn:hover {
            background-color: #e68a00;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            width: 100%;
        }
        
        #message {
            font-weight: bold;
            margin-bottom: 10px;
            min-height: 24px;
        }
        
        #error-output {
            color: #d32f2f;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        
        .success {
            color: #4CAF50;
        }
        
        .error {
            color: #d32f2f;
        }
        
        .hint {
            color: #2196F3;
        }
        
        #output-display {
            background-color: #282c34;
            color: #abb2bf;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            min-height: 50px;
            white-space: pre-wrap;
        }
        
        .output-label {
            font-weight: bold;
            margin-top: 10px;
        }
        
        .level-selector {
            margin-bottom: 20px;
        }
        
        .level-selector button {
            margin: 5px;
            padding: 5px 10px;
        }
        
        .active-level {
            background-color: #333;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Offline C++ Code Fixer</h1>
            <div class="score">
                <span>Score: <span id="score">0</span></span>
                <span>Level: <span id="level">1</span></span>
            </div>
        </header>
        
        <div class="level-selector">
            <button id="level1-btn" class="active-level">Level 1: Basics</button>
            <button id="level2-btn">Level 2: Loops & Arrays</button>
            <button id="level3-btn">Level 3: Pointers & Functions</button>
            <button id="level4-btn">Level 4: OOP</button>
            <button id="level5-btn">Level 5: Advanced</button>
        </div>
        
        <div class="game-area">
            <div class="code-container">
                <h2>Fix this code:</h2>
                <pre id="code-display"><code id="broken-code"></code></pre>
                <div class="output-label">Expected Output:</div>
                <div id="expected-output"></div>
            </div>
            
            <div class="editor-container">
                <h2>Your fix:</h2>
                <textarea id="code-editor" spellcheck="false"></textarea>
                <div>
                    <button id="submit-btn">Submit Fix</button>
                    <button id="hint-btn">Get Hint</button>
                    <button id="next-btn">Next Challenge</button>
                </div>
                <div class="output-label">Your Output:</div>
                <div id="output-display"></div>
            </div>
            
            <div class="feedback">
                <div id="message"></div>
                <div id="error-output"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Extensive code challenges organized by level
        const codeChallenges = {
            1: [
                {
                    title: "Missing Namespace",
                    broken: `#include <iostream>\n\nint main() {\n    cout << "Hello World";\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nint main() {\n    std::cout << "Hello World";\n    return 0;\n}`,
                    hint: "Remember to specify the namespace for cout or use 'using namespace std;'",
                    expectedOutput: "Hello World"
                },
                {
                    title: "Missing Semicolon",
                    broken: `#include <iostream>\n\nint main() {\n    int x = 5\n    std::cout << x;\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nint main() {\n    int x = 5;\n    std::cout << x;\n    return 0;\n}`,
                    hint: "Check for missing semicolons at the end of statements",
                    expectedOutput: "5"
                },
                {
                    title: "Comparison vs Assignment",
                    broken: `#include <iostream>\n\nint main() {\n    int number = 10;\n    if (number = 5) {\n        std::cout << "Number is 5";\n    }\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nint main() {\n    int number = 10;\n    if (number == 5) {\n        std::cout << "Number is 5";\n    }\n    return 0;\n}`,
                    hint: "Check your comparison operator in the if statement",
                    expectedOutput: ""
                }
            ],
            2: [
                {
                    title: "For Loop Syntax",
                    broken: `#include <iostream>\n\nint main() {\n    for (int i = 0; i < 5; i++ {\n        std::cout << i << " ";\n    }\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nint main() {\n    for (int i = 0; i < 5; i++) {\n        std::cout << i << " ";\n    }\n    return 0;\n}`,
                    hint: "Check the syntax of your for loop, particularly the closing parenthesis",
                    expectedOutput: "0 1 2 3 4 "
                },
                {
                    title: "Array Bounds",
                    broken: `#include <iostream>\n\nint main() {\n    int arr[3] = {1, 2, 3};\n    std::cout << arr[3];\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nint main() {\n    int arr[3] = {1, 2, 3};\n    std::cout << arr[2];\n    return 0;\n}`,
                    hint: "Remember that array indices start at 0, so what's the valid range for this array?",
                    expectedOutput: "3"
                },
                {
                    title: "While Loop Condition",
                    broken: `#include <iostream>\n\nint main() {\n    int i = 5;\n    while (i > 0) {\n        std::cout << i << " ";\n        i--;\n    }\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nint main() {\n    int i = 5;\n    while (i > 0) {\n        std::cout << i << " ";\n        i--;\n    }\n    return 0;\n}`,
                    hint: "This code is actually correct! Click Next Challenge",
                    expectedOutput: "5 4 3 2 1 "
                }
            ],
            3: [
                {
                    title: "Memory Leak",
                    broken: `#include <iostream>\n\nint main() {\n    int* ptr = new int;\n    *ptr = 5;\n    std::cout << *ptr;\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nint main() {\n    int* ptr = new int;\n    *ptr = 5;\n    std::cout << *ptr;\n    delete ptr;\n    return 0;\n}`,
                    hint: "Don't forget to clean up dynamically allocated memory",
                    expectedOutput: "5"
                },
                {
                    title: "Function Declaration",
                    broken: `#include <iostream>\n\nint main() {\n    std::cout << add(5, 3);\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nint add(int a, int b) {\n    return a + b;\n}\n\nint main() {\n    std::cout << add(5, 3);\n    return 0;\n}`,
                    hint: "The add function is called but not defined",
                    expectedOutput: "8"
                },
                {
                    title: "Pointer Arithmetic",
                    broken: `#include <iostream>\n\nint main() {\n    int arr[3] = {10, 20, 30};\n    int* ptr = arr;\n    std::cout << *(ptr + 2);\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nint main() {\n    int arr[3] = {10, 20, 30};\n    int* ptr = arr;\n    std::cout << *(ptr + 2);\n    return 0;\n}`,
                    hint: "This code is correct! Pointer arithmetic is working properly.",
                    expectedOutput: "30"
                }
            ],
            4: [
                {
                    title: "Class Definition",
                    broken: `#include <iostream>\n\nclass MyClass {\n    int value;\npublic:\n    MyClass(int v) { value = v; }\n    int getValue();\n};\n\nint main() {\n    MyClass obj(42);\n    std::cout << obj.getValue();\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nclass MyClass {\n    int value;\npublic:\n    MyClass(int v) { value = v; }\n    int getValue() { return value; }\n};\n\nint main() {\n    MyClass obj(42);\n    std::cout << obj.getValue();\n    return 0;\n}`,
                    hint: "The getValue method is declared but not defined",
                    expectedOutput: "42"
                },
                {
                    title: "Inheritance",
                    broken: `#include <iostream>\n\nclass Animal {\npublic:\n    virtual void speak() = 0;\n};\n\nclass Dog : public Animal {\n    void speak() { std::cout << "Woof!"; }\n};\n\nint main() {\n    Dog myDog;\n    myDog.speak();\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nclass Animal {\npublic:\n    virtual void speak() = 0;\n};\n\nclass Dog : public Animal {\npublic:\n    void speak() override { std::cout << "Woof!"; }\n};\n\nint main() {\n    Dog myDog;\n    myDog.speak();\n    return 0;\n}`,
                    hint: "Check the access specifier and consider using override",
                    expectedOutput: "Woof!"
                },
                {
                    title: "Constructor Initialization",
                    broken: `#include <iostream>\n\nclass Point {\n    int x, y;\npublic:\n    Point(int a, int b) {\n        x = a;\n        y = b;\n    }\n    void print() { std::cout << x << "," << y; }\n};\n\nint main() {\n    Point p(3, 4);\n    p.print();\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\nclass Point {\n    int x, y;\npublic:\n    Point(int a, int b) : x(a), y(b) {}\n    void print() { std::cout << x << "," << y; }\n};\n\nint main() {\n    Point p(3, 4);\n    p.print();\n    return 0;\n}`,
                    hint: "Consider using member initializer list for better practice",
                    expectedOutput: "3,4"
                }
            ],
            5: [
                {
                    title: "Template Function",
                    broken: `#include <iostream>\n\nint max(int a, int b) {\n    return (a > b) ? a : b;\n}\n\ndouble max(double a, double b) {\n    return (a > b) ? a : b;\n}\n\nint main() {\n    std::cout << max(5, 3) << " " << max(2.5, 3.1);\n    return 0;\n}`,
                    fixed: `#include <iostream>\n\ntemplate <typename T>\nT max(T a, T b) {\n    return (a > b) ? a : b;\n}\n\nint main() {\n    std::cout << max(5, 3) << " " << max(2.5, 3.1);\n    return 0;\n}`,
                    hint: "Consider using templates to avoid function overloading",
                    expectedOutput: "5 3.1"
                },
                {
                    title: "Lambda Function",
                    broken: `#include <iostream>\n#include <vector>\n#include <algorithm>\n\nint main() {\n    std::vector<int> nums = {3, 1, 4, 1, 5};\n    std::sort(nums.begin(), nums.end(), bool(int a, int b) { return a < b; });\n    for(int n : nums) std::cout << n << " ";\n    return 0;\n}`,
                    fixed: `#include <iostream>\n#include <vector>\n#include <algorithm>\n\nint main() {\n    std::vector<int> nums = {3, 1, 4, 1, 5};\n    std::sort(nums.begin(), nums.end(), [](int a, int b) { return a < b; });\n    for(int n : nums) std::cout << n << " ";\n    return 0;\n}`,
                    hint: "Check the lambda function syntax",
                    expectedOutput: "1 1 3 4 5 "
                },
                {
                    title: "Smart Pointer",
                    broken: `#include <iostream>\n#include <memory>\n\nclass Resource {\npublic:\n    Resource() { std::cout << "Resource acquired\\n"; }\n    ~Resource() { std::cout << "Resource destroyed\\n"; }\n    void use() { std::cout << "Resource used\\n"; }\n};\n\nint main() {\n    Resource* res = new Resource();\n    res->use();\n    return 0;\n}`,
                    fixed: `#include <iostream>\n#include <memory>\n\nclass Resource {\npublic:\n    Resource() { std::cout << "Resource acquired\\n"; }\n    ~Resource() { std::cout << "Resource destroyed\\n"; }\n    void use() { std::cout << "Resource used\\n"; }\n};\n\nint main() {\n    auto res = std::make_unique<Resource>();\n    res->use();\n    return 0;\n}`,
                    hint: "Consider using smart pointers to manage memory automatically",
                    expectedOutput: "Resource acquired\nResource used\nResource destroyed\n"
                }
            ]
        };

        let currentChallenge = {};
        let currentLevel = 1;
        let score = 0;
        let currentChallengeIndex = 0;

        // DOM elements
        const codeDisplay = document.getElementById('broken-code');
        const codeEditor = document.getElementById('code-editor');
        const submitBtn = document.getElementById('submit-btn');
        const hintBtn = document.getElementById('hint-btn');
        const nextBtn = document.getElementById('next-btn');
        const messageEl = document.getElementById('message');
        const errorOutput = document.getElementById('error-output');
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const expectedOutputEl = document.getElementById('expected-output');
        const outputDisplay = document.getElementById('output-display');
        const levelButtons = {
            1: document.getElementById('level1-btn'),
            2: document.getElementById('level2-btn'),
            3: document.getElementById('level3-btn'),
            4: document.getElementById('level4-btn'),
            5: document.getElementById('level5-btn')
        };

        // Initialize the game
        function init() {
            loadRandomChallenge();
            updateScoreDisplay();
            
            // Event listeners
            submitBtn.addEventListener('click', checkSolution);
            hintBtn.addEventListener('click', showHint);
            nextBtn.addEventListener('click', loadRandomChallenge);
            
            // Level selector buttons
            for (const [level, btn] of Object.entries(levelButtons)) {
                btn.addEventListener('click', () => {
                    currentLevel = parseInt(level);
                    levelEl.textContent = currentLevel;
                    loadRandomChallenge();
                    updateActiveLevelButton();
                });
            }
            
            updateActiveLevelButton();
        }

        function updateActiveLevelButton() {
            for (const [level, btn] of Object.entries(levelButtons)) {
                if (parseInt(level) === currentLevel) {
                    btn.classList.add('active-level');
                } else {
                    btn.classList.remove('active-level');
                }
            }
        }

        // Load a random challenge
        function loadRandomChallenge() {
            const challenges = codeChallenges[currentLevel];
            currentChallengeIndex = Math.floor(Math.random() * challenges.length);
            currentChallenge = challenges[currentChallengeIndex];
            
            codeDisplay.textContent = currentChallenge.broken;
            codeEditor.value = currentChallenge.broken;
            expectedOutputEl.textContent = currentChallenge.expectedOutput;
            messageEl.textContent = '';
            errorOutput.textContent = '';
            outputDisplay.textContent = '';
            messageEl.className = '';
        }

        // Check the user's solution
        function checkSolution() {
            const userCode = codeEditor.value.trim();
            const fixedCode = currentChallenge.fixed.trim();
            
            // Simple validation - in a real app you'd want more sophisticated checking
            if (userCode === fixedCode) {
                messageEl.textContent = 'Correct! Well done!';
                messageEl.className = 'success';
                errorOutput.textContent = '';
                outputDisplay.textContent = currentChallenge.expectedOutput;
                score += 10 * currentLevel;
                updateScoreDisplay();
            } else {
                messageEl.textContent = 'Not quite right. Try again!';
                messageEl.className = 'error';
                
                // Try to simulate output (very simplified)
                try {
                    const simulatedOutput = simulateOutput(userCode);
                    outputDisplay.textContent = simulatedOutput;
                    
                    if (simulatedOutput === currentChallenge.expectedOutput) {
                        messageEl.textContent = 'Output matches but code style could be improved! +5 points';
                        score += 5;
                        updateScoreDisplay();
                    }
                } catch (e) {
                    outputDisplay.textContent = 'Error: ' + e.message;
                }
                
                // Simple diff
                const userLines = userCode.split('\n');
                const fixedLines = fixedCode.split('\n');
                
                let diffOutput = '';
                for (let i = 0; i < Math.max(userLines.length, fixedLines.length); i++) {
                    if (userLines[i] !== fixedLines[i]) {
                        diffOutput += `Line ${i+1}:\n`;
                        diffOutput += `Yours:   ${userLines[i] || ''}\n`;
                        diffOutput += `Correct: ${fixedLines[i] || ''}\n\n`;
                    }
                }
                
                errorOutput.textContent = diffOutput || "Your code runs but doesn't match the expected solution.";
            }
        }

        // Very simplified output simulator
        function simulateOutput(code) {
            // This is a mock simulation - in reality we can't execute C++ in browser offline
            // So we just look for obvious patterns
            
            // Check for memory leak challenge
            if (code.includes('new int') && !code.includes('delete')) {
                throw new Error('Memory leak detected');
            }
            
            // Check for expected output patterns
            if (code.includes('"Hello World"')) {
                return "Hello World";
            }
            
            if (code.includes('cout << "Woof!"')) {
                return "Woof!";
            }
            
            if (code.includes('cout << "Resource used"')) {
                return "Resource acquired\nResource used\nResource destroyed\n";
            }
            
            // For number outputs, we'll just return the expected output if the code is similar
            if (code.includes(currentChallenge.expectedOutput)) {
                return currentChallenge.expectedOutput;
            }
            
            throw new Error('Output simulation failed - check your code manually');
        }

        // Show a hint
        function showHint() {
            messageEl.textContent = currentChallenge.hint;
            messageEl.className = 'hint';
            score = Math.max(0, score - 5); // Penalty for using hint
            updateScoreDisplay();
        }

        // Update score display
        function updateScoreDisplay() {
            scoreEl.textContent = score;
        }

        // Start the game when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
